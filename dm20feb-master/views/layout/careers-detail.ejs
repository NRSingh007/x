<%- include('../includes/header.ejs',{ 
    keywords: ['business claim','onwer claim','listing'] , 
    author: 'Digtal Manipur',
    description: `Claim your listing in Digital Manipur`
 }) %>
<link rel="stylesheet" href="/assets/css/career.css">
<link rel="stylesheet" href="/assets/css/site.css">
</head>

<body class="career-detail">
    <%- include('../includes/alert.ejs') %>


    <!-- loader -->
    <div id="loadingMask" 
    style="width: 100%; height: 100%; position: fixed; background: #fff;
    z-index: 9999999;
    ">
    </div>
    <!-- ends -->
    <section class="outer-container">

        <header class="container " id="nav-header">
            <div></div>
            <div class="brand text-center ">
                <i class="far fa-times float-left text-dark close-header" onclick='$("#nav-header").hide()'></i>
                Digital Manipur
            </div>
            <ul class="nav navigations">
                <li class="nav-item">
                    <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/site/about">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="/site/career">
                        Careers

                    </a>
                    <div class="underline"></div>
                </li>
            </ul>

        </header>

        <div class="container " id="mobile-header">

            <i class="far fa-bars mb-0 text-light open-mobile-header"
                onclick='$("#nav-header").css("display","flex")'></i>


            <div class="brand text-center mx-auto">

                Digital Manipur
            </div>
        </div>

        

        

    </section>


    <section class="outer-container">
        <div class="container">

            <!-- path -->
            <div class="paths d-flex flex-row">
                <div class="path">
                    <a href="/site/career">Careers</a>
                </div>
                <div class="seperator mx-2">/</div>
                <div class="path">
                    <a href="/site/career/all" class="">
                        Job Openings
                    </a>
                </div>
                
                <% if ( typeof  job.role != 'undefined' ) { %>
                    <div class="seperator mx-2">/</div>
                    <div class="path">
                        <a href="#" class="disabled">
                            <%= job.role %>
                        </a>
                    </div>
                <% } %>
                   
            </div>
            <!-- ends -->


            <!-- details -->
            <!-- title -->
            <h2 class="text-capitalize mb-0">
                <%= typeof job.role != 'undefined' ? job.role : '' %>
            </h2>
            <div class="mt-0 text-secondary text-capitalize ">
                <%= typeof job.location != 'undefined' ? job.location : '' %>
            </div>
            <hr>
            <h4 class="my-0 p-0" style="color: rgb(237, 90, 107)">
                Job Description
            </h4>
            <hr>
            <div class="my-2 py-2 description">
                  <pre><%= typeof job.description != 'undefined' ? job.description : '' %></pre>  
            </div>
            <hr>
            <h4 class="my-0 p-0" style="color: rgb(237, 90, 107)">
                Job Requirements
            </h4>
            <hr>

            <div class="my-2 py-2 description">
                <pre><%= typeof job.requirements != 'undefined' ? job.requirements : '' %></pre>
            </div>

            <button 
            type="button"
            data-target="#jobFormModal"  data-toggle="modal"
            class="btn btn-danger rounded p-2 px-3 mt-3">Apply now
                <i class="fas fa-caret-right ml-2"></i>
            </button>

        </div>
    </section>
    

    <!-- job form modal -->
    <div class="modal" id="jobFormModal">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
      
            <!-- Modal Header -->
            <div class="modal-header">
              <h3 class="modal-title px-2">Express interest for working at Digital Manipur</h3>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
      
            <!-- Modal body -->
            <div class="modal-body p-4"
            
            style="background-color: #fff;">

            <form action="" id="applyJob">
                
                <h4 class="text-capitalize mb-0" style="color: rgb(237, 90, 107);">
                    <%= typeof job.role != 'undefined' ? job.role : '' %>
                    <input type="text" hidden  name="role" value="<%= typeof job.role != 'undefined' ? job.role : '' %>">

                </h4>
                <div class="mt-2 text-secondary text-capitalize ">
                    <%= typeof job.location != 'undefined' ? job.location : '' %>
                    <input type="text" hidden  name="location" value="<%= typeof job.location != 'undefined' ? job.location : '' %>">

                </div>
                <hr>
                <h5>Personal Information <span class="text-danger">*</span></h5>
                <div class="row px-0 mt-3">
                    <div class="col-xs-12 col-md-6  ">
                        <div class="form-group">
                            <input type="text" name="fullName" class="form-control"  placeholder="Your full name" id="">
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-6">
                        <input type="text" name="email"  placeholder="Your email address" class="form-control">
                    </div>
                </div>
                <div class="row px-0 mt-3">
                    <div class="col-xs-12 col-md-6  ">
                        <div class="form-group">
                            <input type="number" class="form-control"    maxlength="10" name="mobile"  placeholder="Your mobile number" id="">
                        </div>
                    </div>
                </div>
                <div class="row px-0 mt-3">
                    <div class="col-xs-12 col-md-6  ">
                        <div class="custom-file">
                            <input type="file" name="resume" accept=".docx,.pdf" class="custom-file-input"
                                id="customFile">
                            <label class="custom-file-label" for="customFile" style="overflow-x: hidden;"
                                class="text-truncate custom-file-label">Upload your CV or resume file <span class="text-danger">*</span></label>
                        </div>
                        
                       <script>
                            // Add the following code if you want the name of the file appear on select
                            $(".custom-file-input").on("change", function () {
                                var fileName = $(this).val().split("\\").pop();
                                $(this).siblings(".custom-file-label").addClass("selected").html(
                                    fileName);
                            });
                        </script>
                    </div>
                    <div class="col-xs-12 col-md-6  ">
                       <label  for="customFile" style="overflow-x: hidden;"
                                class="text-truncate text-muted small">Maximum file size is 2mb. <span class="text-danger">*</span></label>
                    </div>
                </div>
                <h5 class="mt-3">Questions<span class="text-danger">*</span></h5>

                <div class="row px-0 mt-3 questions">
                    <div class="col-xs-12 col-md-6  ">
                        <label for="">
                            How many years of relevant experience do you have?
                        </label>
                        <input type="number" name="yearsOfExperience"  class="form-control">
                    </div>
                    <div class="col-xs-12 col-md-6  ">
                        <label for="">
                            Which organization are you currently working with?
                        </label>
                        <input type="text" name="previousOrganization"  class="form-control">
                    </div>
                </div>
                <div class="row px-0 mt-3 questions">
                    <div class="col-xs-12 col-md-6  ">
                        <label for="">
                            Which city are you currently in?
                        </label>
                        <input type="text" name="city"  class="form-control">
                    </div>
                    <div class="col-xs-12 col-md-6  ">
                        <label for="">
                            What is your current annual compensation?
                        </label>
                        <input type="number" name="currentAnnualCompensation"  class="form-control">
                    </div>
                </div>
                <div class=" mt-5">
                    <div class="custom-control custom-checkbox ">
                        <input type="checkbox" class="custom-control-input" id="agreementcustomCheck" name="agreement">
                        <label class="text-muted custom-control-label d-inline" for="agreementcustomCheck">
                            I have read and agree with the <a class="mx-2 text-danger" href="/site/privacy">Privacy Policy</a> of Digital Manipur.
                        </label>
                      </div> 
                </div>
                <button id="submitApplication" class="btn btn-success disabled p-2 mt-4">
                    Submit Application
                </button>
            </form>
            </div>
      
          
      
          </div>
        </div>
      </div>
    <!-- ends -->

  
    <%- include('../includes/footer.ejs') %>

      <script>
          $(document).ready( e=> {

            

            // decode text
            decodeText();

            // hide loader
            $('#loadingMask').fadeOut();

          });

          function decodeText() {
            const pres = $('.description pre');
            for( let i = 0; i< pres.length ; i++ ){
                $(pres[i]).html( decodeHTMLEntities($(pres[i]).html()) )
            }
          }

          function decodeHTMLEntities(text) {
            var textArea = document.createElement('textarea');
            textArea.innerHTML = text;
            return textArea.value;
            }

            window.addEventListener("beforeunload",function(e){
                $("#loadingMask").addClass("page-loading");
            },false);
      </script>

      <script>

          // enable form submit when validated
        $("#applyJob").change( e => {
            const formData = new FormData($("#applyJob")[0]);

                for (let [key,val] of formData.entries()) {
                    console.log(key+'-'+val);
                    if (!val) {

                        $("#submitApplication").addClass('disabled');
                        return;
                    }
                }

                if ((formData.get('resume').size / (1024 * 1024)) > 2) {
                    showInfoAlert('File size exceeded. Please select a smaller file.');
                    $("#submitApplication").addClass('disabled');
                    return;
                } else if ( formData.get('resume').size == 0 || formData.get('resume').name == '' ) {
                    $("#submitApplication").addClass('disabled');
                    return;
                }

                if ( !$("#agreementcustomCheck").prop('checked') ) {
                    $("#submitApplication").addClass('disabled');
                    return;
                }

                $("#submitApplication").removeClass('disabled');
        });

           //  apply job
        $("#submitApplication").click(e => {
            e.preventDefault();




            const formData = new FormData($("#applyJob")[0]);

            for (let val of formData.values()) {
                console.log({
                    val
                });
                if (!val) {
                    showInfoAlert('All input fields are required.');
                    return;
                }
            }

            // 5 mb limit
            if ((formData.get('resume').size / (1024 * 1024)) > 2) {
                showInfoAlert('File size exceeded. Please select a smaller file.');
                return;
            }

            $(e.target).html(`Submitting...`).addClass('disabled');
            $.ajax({
                url: `${rootDomain}/site/career/job/apply`,
                type: 'POST',
                data: formData,
                cache: false,
                contentType: false,
                processData: false, // neccessary for file upload
                success: function (data) {
                    console.log('Job applied.');
                    console.log("Res: ", data);

                    if (data && data.msg && data.msg == 'Done') {
                        $("#jobFormModal").modal('hide');
                        showSuccessAlert('Your application has been submitted successfully.');
                        $("#applyJob").trigger('reset');
                        $(".custom-file-label").text('Choose file');
                    }
                    $(e.target).html(`Submit Application`).prop('disabled', false);

                },
                error: function (data) {
                    console.log('Error', data);
                    showDangerAlert('Please try again after some time.');
                    $(e.target).html(`Submit`).prop('disabled', false);

                }
            });

            return false;

        });

        function showSuccessAlert(message) {
            $(".alert-container").show();
            $(".alert-success .message").html(message);
            $(".alert-success").show();

            setTimeout(() => {
                $(".alert-container").hide();
                $(".alert-success").hide();
            }, 3000);

        }

        function showDangerAlert(message) {
            $(".alert-container").show();
            $(".alert-danger .message").html(message);
            $(".alert-danger").show();
            setTimeout(() => {
                $(".alert-container").hide();
                $(".alert-danger").hide();
            }, 3000);
        }

        function showInfoAlert(message) {
            $(".alert-container").show();
            $(".alert-info .message").html(message);
            $(".alert-info").show();
            setTimeout(() => {
                $(".alert-container").hide();
                $(".alert-info").hide();
            }, 3000);
        }


      </script>
</body>

</html>